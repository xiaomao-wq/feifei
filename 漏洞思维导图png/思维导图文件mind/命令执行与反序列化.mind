{"root":{"data":{"id":"d6p2802a3zk0","created":1735564368777,"text":"命令执行与反序列化"},"children":[{"data":{"id":"d6p28k5rk9s0","created":1735564412523,"text":"命令执行","layout_mind_offset":{"x":17.99999920527125,"y":3.6666644149355534}},"children":[{"data":{"id":"d6p28zncd400","created":1735564446238,"text":"命令执行原理"},"children":[{"data":{"id":"d6p297xhx6w0","created":1735564464266,"text":"设计者在编写代码时没有做严格的安全控制，导\n致攻击者通过接口或相关参数提交“意想不到”\n的命令，从而让后台进行执行，从而控制整个后\n台服务器。","layout_right_offset":{"x":14,"y":-33}},"children":[]}]},{"data":{"id":"d6p28zncv7s0","created":1735564446239,"text":"代码执行原理","layout_right_offset":{"x":-4,"y":-17}},"children":[{"data":{"id":"d6p29ejksbc0","created":1735564478662,"text":"程序员在开发的时候，使用了不安全的函数同时\n没有对传入的参数过滤，造成了不安全参数直接\n当作命令执行了。","layout":null},"children":[]}]},{"data":{"id":"d6p2arcknxc0","created":1735564584901,"text":"命令执行测试方法","layout_right_offset":{"x":6,"y":-29}},"children":[{"data":{"id":"d6p2axwchz40","created":1735564599157,"text":"&"},"children":[]},{"data":{"id":"d6p2ay07f080","created":1735564599391,"text":"&&"},"children":[]},{"data":{"id":"d6p2ay3ctkg0","created":1735564599581,"text":"|"},"children":[]},{"data":{"id":"d6p2ayu0zb40","created":1735564601194,"text":"||"},"children":[]}]},{"data":{"id":"d6p2arkzy9c0","created":1735564585410,"text":"命令执行一般出现那些地方","layout_right_offset":{"x":25,"y":-64}},"children":[{"data":{"id":"d6p2bhgrtr40","created":1735564641751,"text":"只要带参数的地方都可能出现命令执行漏洞"},"children":[]},{"data":{"id":"d6p2biy2gu00","created":1735564644974,"text":"常见的路由器、防火墙、入侵检测、自动化运维\n平台"},"children":[]},{"data":{"id":"d6p2bj58xow0","created":1735564645408,"text":"sql注入方式         master..xp_cmd"},"children":[]},{"data":{"id":"d6p2bjvk23k0","created":1735564646999,"text":"xxe","layout_right_offset":{"x":11,"y":-6}},"children":[]}]},{"data":{"id":"d6p2ck460e00","created":1735564725883,"text":"如何挖命令执行漏洞","layout_right_offset":{"x":44,"y":-46}},"children":[{"data":{"id":"d6p2ctkzw000","created":1735564746492,"text":"(1)执行系统命令: assert,system,passthru,\nexec,pcntl exec,shell exec,popen,proc\nopen,“(反单引号)"},"children":[]},{"data":{"id":"d6p2cu26kpk0","created":1735564747531,"text":"(2)代码执行与加密: eval, assert, call_user_\nfunc,base64_decode, gzinflate,\ngzuncompress, gzdecode,str_rot13"},"children":[]},{"data":{"id":"d6p2cu4ukuo0","created":1735564747693,"text":"(3)文件包含与生成:require,require_once,\ninclude, include_once, file_get_contents, file_\nput_contents, fputs, fwrite"},"children":[]},{"data":{"id":"d6p2cvc06y80","created":1735564750302,"text":"(4).htaccess: SetHandler, auto_prepend_\nfile, auto_append_file"},"children":[]}]}]},{"data":{"id":"d6p28kezycg0","created":1735564413082,"text":"反序列化","layout_mind_offset":{"x":-31,"y":-10}},"children":[{"data":{"id":"d6p2fckjhqw0","created":1735564944552,"text":"序列化和反序列化"},"children":[{"data":{"id":"d6p2fl4c58w0","created":1735564963163,"text":"序列化就是把实体对象状态按照一定的格式写入\n到有序字节流，反序列化就是从有序字节流重建\n对象，恢复对象状态。","layout_left_offset":{"x":-22,"y":-14}},"children":[]}]},{"data":{"id":"d6p2fczjrhc0","created":1735564945459,"text":"什么是反序列化漏洞"},"children":[{"data":{"id":"d6p2fyjhd1s0","created":1735564992377,"text":"攻击者序列化一个包含恶意代码的对象，得到对\n象的字节数据。然后字节数据发送到服务器后，\n服务器会反序列化出对象的过程中触发恶意代码\n执行，从而达到攻击的目的。","layout_left_offset":{"x":-1,"y":-13}},"children":[]},{"data":{"id":"d6p2fyu2li80","created":1735564993017,"text":"PHP反序列化，基本都是围绕着serialize()\nunserialize()这两个函数。","layout_left_offset":{"x":-6,"y":-2}},"children":[]}]},{"data":{"id":"d6p2fd2xuh40","created":1735564945664,"text":"反序列化漏洞产生的条件","layout_left_offset":{"x":-3,"y":1}},"children":[{"data":{"id":"d6p2gejfgew0","created":1735565027202,"text":"1)使用了魔术函数;\n(2)参数未经任何过滤;\n(3)对象反序列化","layout_left_offset":{"x":-52,"y":-15}},"children":[]},{"data":{"id":"d6p2gf7iiew0","created":1735565028659,"text":"满足这三个的前提下攻击者把源代码序列化之后\n就可以构造攻击代码","layout_left_offset":{"x":-32,"y":-21}},"children":[]}]},{"data":{"id":"d6p2fd67nj40","created":1735564945862,"text":"反序列化漏洞实验"},"children":[{"data":{"id":"d6p2htfkajk0","created":1735565137984,"text":"PHP反序列化漏洞"},"children":[]},{"data":{"id":"d6p2htfk6g00","created":1735565137984,"text":"Jboss反序列化"},"children":[]},{"data":{"id":"d6p2htfjrio0","created":1735565137984,"text":"Weblogic反序列化"},"children":[{"data":{"id":"d6p2i5tldjk0","created":1735565164954,"text":"弱口令     帐号和密码都是weblogic","layout_left_offset":{"x":-21,"y":-56}},"children":[]},{"data":{"id":"d6p2i5wi8zs0","created":1735565165130,"text":"Java 反亭列化漏洞操作(CVE-2018-2628)\n任意文件上传漏洞操作(CVE-2018-2894)\nXMLDecoder 反序列化漏洞操作(CVE-2017-\n10271)、\nSSRF 漏洞(需要安装Weblogic时选择UDDI组\n件)\n反序列化漏洞(CVE-2019-2725)\n未授权访问命令执行(CVE-2020-14882)","layout_left_offset":{"x":-18,"y":-28}},"children":[]}]}]},{"data":{"id":"d6p2fdci6qo0","created":1735564946243,"text":"PHP反序列化漏洞","layout_left_offset":{"x":-58,"y":-49}},"children":[{"data":{"id":"d6p2iurhm2o0","created":1735565219246,"text":"O:1:\"S\":1:{s:4:\"test\";s:29:\"<script>alert('xss')</script>\";}","layout_left_offset":{"x":-17,"y":-43}},"children":[{"data":{"id":"d6p2jnt4r800","created":1735565282472,"text":"代码\n<?php\nclass S{\npublic $test=\"pikachu\";\n$s=new S(); \n//创建一个对象echo serialize($s); \n//把这个对象进行序列化\n?>","layout_left_offset":{"x":-8,"y":-54}},"children":[]}]},{"data":{"id":"d6p2iutrads0","created":1735565219384,"text":"字符串里构造恶意代码","layout_left_offset":{"x":-90,"y":-52}},"children":[]}]},{"data":{"id":"d6p2fdfsg140","created":1735564946441,"text":"java反序列化漏洞","layout_left_offset":{"x":-75,"y":-84}},"children":[{"data":{"id":"d6p2krpk3d40","created":1735565369328,"text":"Shiro/Fastjson/jackson/rmi/weblogic/jboss/\njenkins/tomcat","layout_left_offset":{"x":-130,"y":-17}},"children":[]}]},{"data":{"id":"d6p2fdj21eg0","created":1735564946639,"text":"通用漏洞","layout_left_offset":{"x":-91,"y":-54}},"children":[{"data":{"id":"d6p2lgwa4200","created":1735565424154,"text":"struts2命令执行漏洞","layout_left_offset":{"x":1,"y":-60}},"children":[{"data":{"id":"d6p2miq841s0","created":1735565506505,"text":"struts2的后缀名"},"children":[{"data":{"id":"d6p2mu0ms340","created":1735565531079,"text":".do"},"children":[]},{"data":{"id":"d6p2mu0mqxs0","created":1735565531079,"text":".action"},"children":[]}]},{"data":{"id":"d6p2mj4wc4o0","created":1735565507393,"text":"工具K8"},"children":[]},{"data":{"id":"d6p2mj6w0yo0","created":1735565507513,"text":"漏洞"},"children":[{"data":{"id":"d6p2n3wxlsw0","created":1735565552623,"text":"s2-005、s2-009、s2-013、s2-016、s2-019.\ndevMode、s2-032、s2-037、s2-045、s2-\n048、s2-052、s2-057","layout_left_offset":{"x":4,"y":-18}},"children":[]}]},{"data":{"id":"d6p2mj8xm800","created":1735565507637,"text":"常见漏洞","layout_left_offset":{"x":-8,"y":-25}},"children":[{"data":{"id":"d6p2ne8jgsg0","created":1735565575093,"text":"S2-045"},"children":[]},{"data":{"id":"d6p2ne8job40","created":1735565575093,"text":"S2-052"},"children":[]},{"data":{"id":"d6p2ne8jo1c0","created":1735565575093,"text":"S2-057"},"children":[]}]},{"data":{"id":"d6p2mjb2bfk0","created":1735565507765,"text":"抓取流量包 工具WSExplorer\nContent-Type标签内 是否包含 #cmd=","layout_left_offset":{"x":-27,"y":-24}},"children":[]},{"data":{"id":"d6p2npce23k0","created":1735565599270,"text":"返回包有strust2的强特征码","layout_left_offset":{"x":-15,"y":-9}},"children":[]}]},{"data":{"id":"d6p2lheu4f40","created":1735565425276,"text":"weblogic","layout_left_offset":{"x":-68,"y":-75}},"children":[{"data":{"id":"d6p2olviurc0","created":1735565670084,"text":"(1)、弱口令\n帐号和密码都是weblogic","layout_left_offset":{"x":11,"y":-12}},"children":[]},{"data":{"id":"d6p2olzfanc0","created":1735565670320,"text":"(2)、反亭列化漏洞(CVE-2018-2628)"},"children":[]},{"data":{"id":"d6p2om1j1340","created":1735565670447,"text":"(3)、任意文件上传漏洞操作(CVE-2018-\n2894)","layout_left_offset":{"x":2,"y":7}},"children":[{"data":{"id":"d6p2pm3l6200","created":1735565748936,"text":"未授权访问路径:http://192.168.0.127:7001/\nws_utc/config.do","layout_left_offset":{"x":-22,"y":-39}},"children":[]},{"data":{"id":"d6p2pmmtlyg0","created":1735565750099,"text":"Weblogic默认路径:C:\\Oracle\\Middleware\\\nOracle_Home\\user_projects\\domains\\base_\ndomain\\tmp\\WSTestPageWorkDir","layout_left_offset":{"x":-23.749999646097535,"y":-33.74999949708581}},"children":[]},{"data":{"id":"d6p2pmpg2940","created":1735565750258,"text":"我们改成以下路径:C:\\Oracle\\Middleware\\\nOracle_Homeluser_projects\\domains\\base_\ndomain\\servers\\AdminServer\\tmp\\_WL_\ninternalwstestclienti7n5e1\\war\\css","layout_left_offset":{"x":-21.249999683350325,"y":-29.999999552965278}},"children":[]},{"data":{"id":"d6p2pmsaf400","created":1735565750430,"text":"木马上传上去之后，访问方式如下:http;//192\n168.0.127:7001/ws_utc/css/config/keystore/\n1604376329959_whoami.jsp","layout_left_offset":{"x":-31.249999534338826,"y":-26.249999608844405}},"children":[]}]},{"data":{"id":"d6p2s1uuhyg0","created":1735565939964,"text":"(4)、SSRF漏洞(可参考:https://www.\njianshu.com/p/97b157a20108)","layout_left_offset":{"x":-21.249999683350325,"y":-86.24999871477496}},"children":[]}]},{"data":{"id":"d6p2lhhxgq00","created":1735565425463,"text":"Shiro反序列化","layout_left_offset":{"x":-43.74999934807431,"y":-153.74999770894647}},"children":[{"data":{"id":"d6p2sx0nesg0","created":1735566007796,"text":"请求头 cookie部分存在有以下字段\nRememberme=xxxx","layout_left_offset":{"x":-4.999999925493967,"y":-6.2499999068677425}},"children":[]}]},{"data":{"id":"d6p2t54xfc00","created":1735566025469,"text":"fastjson","layout_left_offset":{"x":-52.49999921768904,"y":-143.74999785795808}},"children":[{"data":{"id":"d6p2t80rwso0","created":1735566031748,"text":"匹配json数据中是否含有RM:// / LDAP://","layout_left_offset":{"x":-1.2499999813735485,"y":-6.2499999068677425}},"children":[]}]},{"data":{"id":"d6p2ticyv2g0","created":1735566054253,"text":"jboss","layout_left_offset":{"x":-52.49999921768915,"y":-148.74999778345227}},"children":[{"data":{"id":"d6p2tqvx9kw0","created":1735566072813,"text":"jdk1.8版本 反序列化利用工具"},"children":[]},{"data":{"id":"d6p2tvsdsls0","created":1735566083483,"text":"步骤"},"children":[{"data":{"id":"d6p2u0dku0o0","created":1735566093472,"text":"查找网站物理路径"},"children":[{"data":{"id":"d6p2udfscu00","created":1735566121904,"text":"命令执行 dir /s c:\\*.jsp","layout_left_offset":{"x":24.999999627471084,"y":-2.499999962747097}},"children":[]}]},{"data":{"id":"d6p2u1grirs0","created":1735566095841,"text":"上传木马 菜刀链接"},"children":[]}]}]},{"data":{"id":"d6p2tiy57sg0","created":1735566055533,"text":"thinkphp","layout_left_offset":{"x":-59.99999910593044,"y":-192.49999713152647}},"children":[]},{"data":{"id":"d6p2v5iosj40","created":1735566183029,"text":"jenkins","layout_left_offset":{"x":-61.24999908730376,"y":-191.24999715015292}},"children":[]},{"data":{"id":"d6p2v5iox1s0","created":1735566183029,"text":"tomcat","layout_left_offset":{"x":-57.49999914318312,"y":-189.99999716877937}},"children":[{"data":{"id":"d6p2vilclc00","created":1735566211488,"text":"CVE-2020-1938"},"children":[]}]}]},{"data":{"id":"d6p2vxwvua80","created":1735566244837,"text":"安全防范","layout_left_offset":{"x":-74.58333064905491,"y":-202.49999673416255}},"children":[{"data":{"id":"d6p2wffji4o0","created":1735566282971,"text":"安全配置好php相关参数:通过Php.ini配置文件里\n面有个disable functions=配置，这个禁止菜\n些php函数，\n服务器便是用这个来禁止php的执行命令函数","layout_left_offset":{"x":-14.999999776482582,"y":-51.24999923631549}},"children":[{"data":{"id":"d6p2wnxt5ww0","created":1735566301489,"text":"(1)执行系统命令:assert,system,passthru,\nexec,pcntl exec,shell exec,popen,proc\nopen“(反单引号)\n(2)代码执行与加密: eval,assert, call user\nfunc,base64 decode, gzinflate,\ngzuncompress, gzdecode,str rot13","layout_left_offset":{"x":4.999999925493967,"y":-14.999999776482582}},"children":[]}]},{"data":{"id":"d6p2wfsjnrc0","created":1735566283757,"text":"升级中间件","layout_left_offset":{"x":-53.749999199062586,"y":-66.24999901279807}},"children":[]},{"data":{"id":"d6p2wghbu0g0","created":1735566285255,"text":"严格控制传入变量，严谨使用魔法函数","layout_left_offset":{"x":-51.249999236315375,"y":-56.24999916180968}},"children":[]},{"data":{"id":"d6p2wh58b480","created":1735566286701,"text":"对相关参数进行限制例如执行","layout_left_offset":{"x":-14.999999776482582,"y":-29.999999552965164}},"children":[{"data":{"id":"d6p2xi3a5gg0","created":1735566367124,"text":"系统命令的参数1,assert2,exec3,system 4,\nshell exec等","layout_left_offset":{"x":-31.249999534338713,"y":-29.999999552965164}},"children":[]},{"data":{"id":"d6p2xil3wf40","created":1735566368202,"text":"代码执行参数:1,eval 2,assert. //php.ini","layout_left_offset":{"x":-32.49999951571226,"y":-7.499999888241291}},"children":[]}]}]}]}]},"template":"default","theme":"fresh-blue","version":"1.4.43"}